<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motion Editor User Study</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 90%;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        h1 {
            text-align: center;
        }
        
        .video-container {
            background-color: white;
            margin-bottom: 30px;
            padding: 20px 0 0 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .video-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            padding: 0 20px;
        }

        .video-wrapper {
            position: relative;
            width: calc(100% - 40px);
            margin: 0 20px;
        }

        video {
            width: 100%;
            height: auto;
            display: block;
        }

        .intent {
            font-size: 18px;
            color: #555;
            margin: 20px 20px 0 20px;
            padding: 10px;
            background-color: #f0f0f0;
            border-left: 4px solid #2196F3;
        }

        .questions {
            margin: 0;
            padding: 0 0 20px 0;
            position: relative;
        }

        .question {
            background-color: #f9f9f9;
            padding: 15px 0 0 0;
            margin: 0 20px 15px 20px;
            border-radius: 5px;
            position: relative;
        }

        .question::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background-color: #007bff;
            border-radius: 5px 0 0 5px;
        }

        .question-title {
            font-weight: bold;
            margin-bottom: 10px;
            padding: 0 15px;
            color: #333;
        }

        .options {
            display: flex;
            width: 100%;
            margin: 10px 0 15px 0;
        }

        .option {
            flex: 1;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border: 3px solid #ddd;
            background-color: #f9f9f9;
            transition: all 0.2s ease;
            user-select: none;
        }

        .option:hover {
            background-color: #e3f2fd;
            border-color: #2196F3;
        }

        .option.selected {
            background-color: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .submit-section {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
        }

        button {
            background-color: #2196F3;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background-color: #0b7dda;
        }

        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .result.success {
            background-color: #d4edda;
            color: #155724;
        }

        .json-display-section {
            margin-top: 40px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            border: 2px solid #ddd;
        }

        .json-display-section h3 {
            margin-top: 0;
            color: #333;
        }

        #json-output {
            width: 100%;
            height: 200px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: auto;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <h1>Motion Editor User Study</h1>
    <div id="video-containers"></div>
    
    <div class="submit-section">
        <button type="button" onclick="submitStudy()">Submit Responses</button>
        <div id="result"></div>
    </div>

    <div class="json-display-section">
        <h3>Current Responses (JSON)</h3>
        <div id="json-output"></div>
    </div>

    <script>
        // ===== CONFIGURATION: Change these values to modify what gets stored in JSON =====
        const JSON_VALUE_A = "O";
        const JSON_VALUE_B = "R";
        // ================================================================================

        const shuffleMapping = {"0": {"seed": "[Seed 6227] Boat_ Move Test", "intent": "Make the boat move more to the left - change nothing else. Keep the same background and camera movement.", "option_a": "ours", "option_b": "ray"}, "1": {"seed": "[Seed 5201] Reverse Windmills", "intent": "Make the right larger windmill spin counterclockwise instead of clockwise. Leave everything else alone", "option_a": "ours", "option_b": "ray"}, "2": {"seed": "[Seed 4152] Mirror the car to the other lane and make it go faster", "intent": "Move the car into the left lane. change nothing else - same camera movement, car speed, environment etc. But now, the car should be on the left lane.", "option_a": "ray", "option_b": "ours"}, "3": {"seed": "[Seed 8184] Judge_ Walk Out", "intent": "Make the judge enter from the right of the scene, instead of the left as she does right now. Make her walk in from right to left.", "option_a": "ours", "option_b": "ray"}, "4": {"seed": "[Seed 2129] Truck Before Cab [Old]", "intent": "Make the yellow taxi slower and the green truck faster, such that the green truck appears ahead of the yellow taxi and the green truck appears earlier.", "option_a": "ours", "option_b": "ray"}};
        let results = {};

        function createVideoContainer(idx) {
            const container = document.createElement('div');
            container.className = 'video-container';

            const title = document.createElement('div');
            title.className = 'video-title';
            title.textContent = 'Video Pair ' + (idx + 1);

            const videoWrapper = document.createElement('div');
            videoWrapper.className = 'video-wrapper';

            const video = document.createElement('video');
            video.autoplay = true;
            video.loop = true;
            video.muted = true;
            video.controls = true;
            const source = document.createElement('source');
            source.src = 'data/videos_blind/prompt_' + idx + '.mp4';
            source.type = 'video/mp4';
            video.appendChild(source);

            videoWrapper.appendChild(video);

            const intent = document.createElement('div');
            intent.className = 'intent';
            intent.textContent = 'Intent: ' + shuffleMapping[idx].intent;

            const questionsContainer = document.createElement('div');
            questionsContainer.className = 'questions';

            ['Q1: Which video best preserves the input content?', 'Q2: Which video best follows the desired intent/motion?'].forEach((qText, qIndex) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';

                const questionTitle = document.createElement('div');
                questionTitle.className = 'question-title';
                questionTitle.textContent = qText;

                const options = document.createElement('div');
                options.className = 'options';

                const optionA = shuffleMapping[idx].option_a;
                const optionB = shuffleMapping[idx].option_b;

                [optionA, optionB].forEach((value, idx2) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.textContent = idx2 === 0 ? 'A' : 'B';

                    optionDiv.addEventListener('click', () => {
                        options.querySelectorAll('.option').forEach(opt => {
                            opt.classList.remove('selected');
                        });

                        optionDiv.classList.add('selected');

                        if (!results[idx]) results[idx] = {};
                        const jsonValue = value === optionA ? JSON_VALUE_A : JSON_VALUE_B;
                        results[idx][`q${qIndex + 1}`] = jsonValue;
                        updateJsonDisplay();
                    });

                    options.appendChild(optionDiv);
                });

                questionDiv.appendChild(questionTitle);
                questionDiv.appendChild(options);
                questionsContainer.appendChild(questionDiv);
            });

            container.appendChild(title);
            container.appendChild(videoWrapper);
            container.appendChild(intent);
            container.appendChild(questionsContainer);

            return container;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const videoContainers = document.getElementById('video-containers');
            for (let i = 0; i < 5; i++) {
                videoContainers.appendChild(createVideoContainer(i));
            }
        });

        function updateJsonDisplay() {
            const jsonOutput = document.getElementById('json-output');
            jsonOutput.textContent = JSON.stringify(results, null, 2);
        }

        function submitStudy() {
            const resultDiv = document.getElementById('result');
            const jsonBody = JSON.stringify(results, null, 2);
            const mailtoLink = 'mailto:ryancentralorg@gmail.com?subject=user study results&body=' + encodeURIComponent(jsonBody);

            window.location.href = mailtoLink;

            resultDiv.textContent = 'Opening your email client...';
            resultDiv.className = 'result success';
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateJsonDisplay();
        });

        const originalUpdateJson = updateJsonDisplay;
        const observer = setInterval(updateJsonDisplay, 500);
    </script>
</body>
</html>
